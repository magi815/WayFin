<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>지도 앱 - GPS 위치 추적</title>
    <link rel="stylesheet" href="lib/leaflet/leaflet.css" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div id="map"></div>

    <!-- Right controls -->
    <div id="controls">
        <button id="btn-locate" title="내 위치">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <circle cx="12" cy="12" r="3" fill="currentColor"/>
                <path d="M12 2v3M12 19v3M2 12h3M19 12h3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <circle cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="1.5"/>
            </svg>
        </button>
        <button id="btn-track" title="위치 추적">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" fill="currentColor"/>
                <circle cx="12" cy="9" r="2.5" fill="white"/>
            </svg>
        </button>
        <button id="btn-zoom-in" title="확대">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path d="M12 6v12M6 12h12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
        </button>
        <button id="btn-zoom-out" title="축소">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path d="M6 12h12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
        </button>
        <button id="btn-buildings" title="건물 목록">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path d="M4 6h16M4 12h16M4 18h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
    </div>

    <!-- Left draw panel -->
    <div id="draw-panel">
        <button id="btn-draw" title="건물 삽입">
            <svg viewBox="0 0 24 24" width="24" height="24">
                <path d="M3 21V7l9-5 9 5v14H3z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                <rect x="8" y="11" width="3" height="4" fill="currentColor" rx="0.5"/>
                <rect x="13" y="11" width="3" height="4" fill="currentColor" rx="0.5"/>
                <rect x="10" y="17" width="4" height="4" fill="none" stroke="currentColor" stroke-width="1.2"/>
            </svg>
        </button>
        <div id="draw-sub-tools" class="hidden">
            <button id="btn-shape-rect" title="사각형">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <rect x="4" y="4" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" rx="1"/>
                </svg>
            </button>
            <button id="btn-shape-circle" title="원">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/>
                </svg>
            </button>
            <div id="shape-history"></div>
        </div>
    </div>

    <div id="info-panel" class="hidden">
        <div id="info-header">
            <span>위치 정보</span>
            <button id="btn-close-info">&times;</button>
        </div>
        <div id="info-body">
            <div class="info-row">
                <span class="info-label">위도</span>
                <span id="info-lat" class="info-value">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">경도</span>
                <span id="info-lng" class="info-value">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">정확도</span>
                <span id="info-accuracy" class="info-value">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">고도</span>
                <span id="info-altitude" class="info-value">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">속도</span>
                <span id="info-speed" class="info-value">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">이동 거리</span>
                <span id="info-distance" class="info-value">-</span>
            </div>
        </div>
    </div>

    <!-- Building name dialog -->
    <div id="building-dialog" class="hidden">
        <div class="dialog-backdrop"></div>
        <div class="dialog-content">
            <h3>건물 정보 입력</h3>
            <input type="text" id="building-name" placeholder="건물 이름" maxlength="50" />
            <input type="text" id="building-desc" placeholder="설명 (선택)" maxlength="100" />
            <div class="dialog-colors">
                <span class="color-option selected" data-color="#e53e3e" style="background:#e53e3e"></span>
                <span class="color-option" data-color="#dd6b20" style="background:#dd6b20"></span>
                <span class="color-option" data-color="#38a169" style="background:#38a169"></span>
                <span class="color-option" data-color="#2563eb" style="background:#2563eb"></span>
                <span class="color-option" data-color="#805ad5" style="background:#805ad5"></span>
                <span class="color-option" data-color="#718096" style="background:#718096"></span>
            </div>
            <div class="dialog-buttons">
                <button id="dialog-cancel">취소</button>
                <button id="dialog-save">저장</button>
            </div>
        </div>
    </div>

    <!-- Building list panel -->
    <div id="building-list-panel" class="hidden">
        <div id="building-list-header">
            <span>건물 목록</span>
            <button id="btn-close-building-list">&times;</button>
        </div>
        <div id="building-list-actions">
            <button id="btn-export-buildings">
                <svg viewBox="0 0 24 24" width="16" height="16"><path d="M12 3v12M12 3l4 4M12 3L8 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/><path d="M4 17v2a2 2 0 002 2h12a2 2 0 002-2v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
                내보내기
            </button>
            <button id="btn-import-buildings">
                <svg viewBox="0 0 24 24" width="16" height="16"><path d="M12 15V3M12 15l4-4M12 15L8 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/><path d="M4 17v2a2 2 0 002 2h12a2 2 0 002-2v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
                가져오기
            </button>
        </div>
        <div id="building-list-body">
            <div id="building-list-empty">저장된 건물이 없습니다</div>
        </div>
    </div>
    <input type="file" id="import-file-input" accept=".json" style="display:none" />

    <!-- Shape overlay (for drag/resize/rotate) -->
    <div id="shape-overlay" class="hidden">
        <div id="shape-body"></div>
        <div class="resize-handle" data-pos="tl"></div>
        <div class="resize-handle" data-pos="tr"></div>
        <div class="resize-handle" data-pos="br"></div>
        <div class="resize-handle" data-pos="bl"></div>
        <div id="rotate-handle"></div>
        <button id="btn-shape-confirm">완료</button>
    </div>

    <!-- Draw mode hint -->
    <div id="draw-hint" class="hidden">
        <span>지도를 터치하여 꼭짓점을 추가하세요</span>
        <div class="draw-hint-actions">
            <button id="btn-undo-point">되돌리기</button>
            <button id="btn-finish-draw">완료</button>
            <button id="btn-cancel-draw">취소</button>
        </div>
    </div>

    <div id="toast" class="hidden"></div>

    <script src="lib/leaflet/leaflet.js"></script>
    <script>
        // Unregister old service worker and clear caches
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(regs) {
                regs.forEach(function(r) { r.unregister(); });
            });
            caches.keys().then(function(names) {
                names.forEach(function(n) { caches.delete(n); });
            });
        }
    </script>
    <script src="app.js"></script>
</body>
</html>
